---
title: "住所入力フォームを作るときに考えること"
emoji: "🏘"
type: "tech"
topics: []
published: false
---

# 住所入力フォームを作るときに考えること

この記事は、Wano Group Advent Calendar 2024の3日目の記事です。

大体のことは[ケンオールさんのブログ](https://blog.kenall.jp/)に書いてあります。実際に

どうしても泥臭い
住所をシステムで扱う際のつらいポイントがあるという話は定期的に話題になっていたりもするので、ご存じの方も多いかもしれませんが、大事な話は何度してもいいと思うので

## 郵便番号から住所を自動入力する

この記事のメインです。郵便番号を入力すると都道府県、市区町村、町域名まで自動入力してくれるUIを提供しているサービスも多くあり、皆さんにも馴染みがあると思います。しかし、このUIを実装するにあたって、いくつかエッジケースを考慮する必要があります。

### 1つの郵便番号に複数の町域が紐づく場合

### 1つの町域が複数の郵便番号が紐づく場合

### 該当する住所がなく、下2桁が `00` の郵便番号が割り当てられている場合

#### 「以下」が地名として町域に含まれる場合

上記とは別に、実際に「以下」という地名を持つ住所が存在します。

[〒851-0502 長崎県長崎市以下宿町](https://www.post.japanpost.jp/cgi-zip/zipcode.php?pref=42&city=1422010&id=148962&merge=)

そのため、町域名に「以下」を含んでいる場合は町域名を削除するという条件では不十分で、「を以下に」等でヒットさせた上でマッチした町域名を削除する必要があります。

### ある地域全体を表す「一円」が町域に含まれる場合

#### 「一円」が地名として町域に含まれる場合

上記では「一円」が「ある地域全体」の意味で使用されていましたが、それとは別に実際に「一円」という地名を持つ住所も存在します。

[〒522-0317 滋賀県犬上郡多賀町一円](https://www.post.japanpost.jp/cgi-zip/zipcode.php?pref=25&city=1254430&id=99891&merge=)

そのため、町域名に「一円」を含んでいる場合は町域名を削除するという条件では不十分で、一円の前に何らかの単語を含む（`.+一円`）場合にのみ町域名を削除する必要があります。

## API・オープンデータ

### 日本郵政の提供する

長らく`ken_all.csv`として日本郵政から提供されていたデータですが、以下のような

- ShiftJISでエンコードされている

2023年6月に大幅にアップデートされ、新たに[`utf_all.csv`](https://www.post.japanpost.jp/zipcode/dl/utf-zip.html)として提供されています。
この新形式のファイルでは文字コードや複数行に渡っていたレコードの取り扱い等、使い勝手が大きく改善されました。
とはいえ、上述のようなパターンは未だ町域名に残っており

### デジタル庁の提供するアドレス・ベース・レジストリ

## まとめ

個人的には国が

## 最後に

WanoグループではWebエンジニアを募集しています。ご興味のある方は是非、 https://group.wano.co.jp/jobs/ からお申し込みください。
